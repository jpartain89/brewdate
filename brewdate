#!/bin/bash -e

# Single-worded command to - for now as of 3.20.16 at 7:14 am -
# update, upgrade, cleanup and "doctor" homebrew and brew cask.

# Now self-installs

# Copyright Â© 2017 JPCDI, JPartain89 and Justin Partain
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

trap 'exit 0' SIGHUP SIGINT SIGTERM EXIT

# Program information
PROGRAM_NAME="brewdate"
PROGRAM_AUTHOR_CONTACT="$PROGRAM_NAME.admin@jpcdi.com"
PROGRAM_AUTHOR_FULL="JPCDI, JPartain89 and $PROGRAM_AUTHOR"
VERSION="2.5.2"

if [[ ! -e "$(which allunix)" ]]; then
    echo "AllUnix file is missing."
    wget -O - http://bit.ly/jp_allunix | bash
fi

source allunix &&
git_cloning &&
git_updating &&
homebin_install &&
no_sudo &&

brew_var () {
    echo "${CYAN}Brew Update${NORMAL}"
    echo ""
    /usr/local/bin/brew update;
    echo ""
    echo "${BROWN}Brew Upgrade${NORMAL}"
    echo ""
    /usr/local/bin/brew upgrade;
    echo ""
    echo "${GRAY}Brew Cleanup${NORMAL}"
    echo ""
    /usr/local/bin/brew cleanup;
    echo ""
    echo "${GREEN}Brew Prune${NORMAL}"
    echo ""
    /usr/local/bin/brew prune && echo "Completed";
    echo ""
    echo "${MAGENTA}Brew Doctor${NORMAL}"
    echo ""
    /usr/local/bin/brew doctor;
    echo ""
    echo "${BLUE}Brew Cask Cleanup${NORMAL}"
    echo ""
    /usr/local/bin/brew cask cleanup;
    echo ""
    echo "${PURPLE}Brew Cask Doctor${NORMAL}"
    echo ""
    /usr/local/bin/brew cask doctor
}

help_text () {
cat <<- EOF
Usage: brewdate

This is a simple wrapper script that just auto-runs:

    brew update
    brew upgrade
    brew cleanup
    brew prune
    brew doctor
    brew cask update
    brew cask cleanup
        and
    brew cask doctor
EOF
}

ERROR () {
    echo "${WARNING}Sorry, either encountered an error or a 'stop' signal.
    Also, only -h, --help, -V, --version, -C and --copyright
    are the allowed command line flags.
    Now exiting.${NORMAL}"
}

while [ "$#" -ge 1 ]; do
    case "$1" in
        -h | --help ) help_text; exit 0;;
        -V | --version ) HELP_VERSION; exit 0;;
        -C | --copyright ) COPYRIGHT; exit 0;;
        * ) ERROR; exit 1;;
    esac
done
brew_var; EXIT_NORM
